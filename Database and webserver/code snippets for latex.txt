Code snippets for data publish:

var mysql = require('mysql'); 
var mqtt = require('mqtt');
var client = mqtt.connect('mqtt:localhost:1883')

var connection = mysql.createConnection({
    ...
});

client.on('connect', (err) => {
	console.log("Connected, trying to subscribe")
	client.subscribe(Topic, mqtt_subscribe);
})

function mqtt_subscribe(err, granted) {
    console.log("Subscribed to " + Topic);
    if (err) {console.log(err);}
};

function mqtt_messsageReceived(topic, message) {
	const obj = JSON.parse(message)
	...
	
		if(topic === "server/main_table"){
			split_data_main(obj)
		}
		else if (topic === "server/dump_table"){
			split_data_dump(obj)
		}
	...
};

function split_data_main (obj){
	var user_id = obj.patientId
	...
	insert_main(user_id, session_id, start_time, time_to_bathroom, visit_length, time_from_bathroom)	
}

function insert_main(user_id, session_id, start_time, time_to_bathroom, visit_length, time_from_bathroom) { //topic, message_str, packet
	var query = "INSERT INTO main_data (user_id, session_id, start_time, time_to_bathroom, time_on_bathroom, time_from_bathroom) VALUES (?, ?, ?, ?, ?, ?)"
	connection.query(query, [user_id, session_id, start_time, time_to_bathroom, visit_length, time_from_bathroom], (err) =>{
		if (err){
		  console.log(err);
		}
		else console.log("Inserted successfully.");
	});
};


CODE SNIPPETS FOR SEND DATA PYTHON FILE

class publisher:
    def publishData_main(...):
        event = HEUCOD.HeucodEvent()
        
	...

        publish.single(hostname="192.168.2.204",
                        port = 1883,
                        topic=f"server/main_table", 
                        payload = event.to_json())


Code snippets for webserver:


